# 추세 돌파 모멘텀 전략 설계서

## 1. 전략 개요
- **대상 자산**: 빗썸 KRW 마켓(BTC, ETH 우선) — 유동성과 추세성이 높은 자산을 선별.
- **전략 철학**: 일정 기간의 고가를 돌파하는 시점을 추세 시작으로 간주하고, 거래량 확인을 통해 가짜 돌파(false breakout)를 걸러내며, 손절·익절 규칙으로 손실을 제한.
- **전략 목표**: 손익비 1:2 이상을 확보하면서 승률 40% 이상, 월간 MDD(Maximum Drawdown) 8% 이내 유지.

## 2. 데이터 및 지표 요구사항
| 구분 | 항목 | 세부 내용 |
|------|------|-----------|
| 캔들 데이터 | 1시간봉 OHLCV | 최근 90일 이상 저장, 실시간 업데이트(REST + WebSocket). |
| 보조 지표 | 20일 최고가(HH), 20일 최저가(LL), 20일 거래량 평균(Volume SMA) | 파라미터 설정 가능하도록 구성. |
| 리스크 지표 | ATR(14) | 손절/트레일링 폭 보정용. |

## 3. 진입 및 청산 규칙
1. **롱 포지션 진입 조건**
   - 현재가가 최근 20봉 최고가(HH)를 종가 기준으로 상향 돌파.
   - 현재 거래량이 20봉 거래량 평균 대비 1.5배 이상.
   - 직전 시그널이 손절로 종료된 경우 2봉 동안 재진입 금지(쿨다운).
2. **롱 청산 조건**
   - 고정 손절: 진입가 대비 -1.5%.
   - 1차 익절: +3% 도달 시 포지션의 50% 청산 후 잔여분은 트레일링 스탑(ATR 기반 1%) 적용.
   - 트레일링 스탑: 최고가 대비 1% 이상 하락 시 잔여 포지션 청산.
3. **숏 포지션**
   - 초기 MVP에서는 롱만 지원. 추후 시장 상황에 따라 숏 전략 추가.

## 4. 포지션 및 자금 관리
- 1회 거래 시 사용 가능한 최대 자본: 계좌 평가액의 5%.
- 동시 보유 포지션 수: 1개(동일 자산 기준) — 손익 추적 및 리스크 통제 단순화를 위함.
- 일일 손실 한도: -5% 초과 시 당일 거래 중단.
- 최대 연속 손실 횟수: 3회 → 초과 시 전략 자동 일시중지 및 Slack 알림.

## 5. 시스템 구성 요소 매핑
| 구성 요소 | 설명 | 구현 메모 |
|------------|------|-----------|
| `MarketDataService` | REST + WebSocket 데이터 수집, 1시간봉 리샘플링 | HTTPX, websockets, pandas 활용 |
| `BreakoutStrategy` | 진입/청산 조건 계산, 시그널 생성 | 최근 20봉 버퍼 유지, 거래량 필터 적용 |
| `RiskManager` | 포지션 크기 산출, 일일 손실 한도 체크 | 계좌 정보/주문 기록 활용 |
| `OrderExecutor` | 시장가/지정가 주문 발행, 체결 추적 | API 실패 시 3회 재시도, 백오프 |
| `PerformanceTracker` | 거래별/일별 수익률, MDD 계산 | SQLite + pandas 리포트 |
| `NotificationService` | Slack Webhook, 이메일(선택) | 에러/체결/성과 알림 템플릿 |

## 6. 백테스트 및 검증 계획
1. **데이터 수집**: 빗썸 OHLCV REST API로 최소 6개월 분 데이터를 확보.
2. **시뮬레이션 엔진**: pandas 기반 이벤트 드리븐 백테스터, 슬리피지/수수료(0.15%) 적용.
3. **평가 지표**: CAGR, MDD, 샤프 비율(0% 무위험), 승률, Profit Factor.
4. **검증 절차**
   - 기본 파라미터(20, 1.5배 거래량, 손절 -1.5%)로 백테스트.
   - 파라미터 그리드 서치(기간 10~30, 거래량 배수 1.2~2.0, 손절 1~2%).
   - 워크포워드 테스트: 3개월 훈련 → 1개월 검증 롤링.
5. **결과 기록**: `reports/` 폴더에 CSV/그래프 저장(추후 생성).

## 7. 운영 중 모니터링 포인트
- 체결 지연 시간: 평균 2초 초과 시 Slack 경고.
- WebSocket 끊김 횟수: 시간당 3회 이상 시 재연결 및 운영자 확인 요청.
- 손절 연속 발생: 3회 이상 시 전략 자동 중단 및 재검토.
- 성과 요약: 일별 PnL, 누적 MDD, 거래 횟수를 FastAPI `/status`에서 확인.

## 8. 향후 확장 아이디어
- 다중 타임프레임 확인(1시간 + 4시간)으로 추세 신뢰도 향상.
- 포지션 헤징을 위한 숏 전략 추가.
- 머신러닝 기반 가짜 돌파 감지 모델 도입.
- 거래소 다변화(업비트, 바이낸스) 및 계좌 분산 운영.

본 설계서는 MVP 전략 구현의 기준 문서로 활용되며, 실거래 적용 전 모의투자/백테스트 결과를 반드시 검토해야 합니다.
