# 빗썸 자동매매 MVP 개발 계획

## 1. 계획 개요
- **목표**: 빗썸 KRW 마켓을 대상으로 추세 돌파 모멘텀 전략을 자동으로 실행하고, 최소한의 리스크 제어와 모니터링을 제공하는 MVP 구축.
- **대상 사용자**: 웹 기반 IDE(예: GitHub Codespaces)만 사용할 수 있는 초보 개발자.
- **산출물**: 전략 엔진, 주문 실행 모듈, 기본 API 서버(FastAPI), SQLite 기반 데이터 저장소, 간단한 웹/슬랙 알림.
- **성공 기준**: (1) 실시간 시세 수집, (2) 전략 시그널 생성, (3) 모의/소액 실거래 주문 실행, (4) 전략 성과 리포트 자동 생성.

## 2. 전략 후보 평가 및 선정
| 전략 | 개요 | 장점 | 단점 | 평가 |
|------|------|------|------|------|
| 이동평균 골든크로스 | 단기/장기 이동평균 교차로 매매 | 단순, 백테스트 용이 | 박스권에서 손실 | ★★★★☆ |
| RSI 기반 역추세 | RSI 과매수/과매도 구간 활용 | 변동성 낮은 구간에서 강함 | 강한 추세에서 손절 잦음 | ★★★☆☆ |
| 추세 돌파 모멘텀 | 핵심 가격 구간 돌파 시 매수/손절 | 강한 추세 구간 수익 극대화 | 가짜 돌파에 취약 | ★★★★★ |
| 변동성 돌파(Keltner) | ATR 기반 변동성 밴드 돌파 | 추세+변동성 반영 | 파라미터 튜닝 필요 | ★★★★☆ |
| 그리드 트레이딩 | 일정 간격 주문 배치 | 횡보장 수익 | 추세장 손실 커짐 | ★★☆☆☆ |

> **선정 전략**: `추세 돌파 모멘텀 전략`. 최근 암호화폐 시장의 추세성(높은 변동성과 방향성)에 유리하며, 리스크 관리 규칙(손절/트레일링 스탑)과 함께 사용 시 기대 수익이 가장 높다고 판단.

## 3. MVP 범위 정의
1. **데이터 수집**
   - REST API: 최근 시세, 주문 현황, 계좌 정보 수집.
   - WebSocket: 실시간 체결가 구독 및 재접속 처리.
2. **전략 엔진**
   - 분봉 데이터로 돌파 구간 산출(20일 고가 돌파 + 거래량 필터).
   - 포지션 크기 계산: 계좌 자산의 최대 5%.
   - 손절/익절: 손절 -1.5%, 최초 익절 +3%, 이후 트레일링 1%.
3. **주문 실행 및 리스크 관리**
   - 주문 요청, 체결 확인, 실패 재시도(3회) 로직.
   - 일일 최대 손실률 5% 초과 시 거래 중단.
4. **서비스 계층**
   - FastAPI 기반 백오피스: 상태 확인, 전략 중지/재개 API.
   - Slack Webhook 알림: 시그널 발생, 체결 결과, 오류.
5. **데이터 저장 및 리포트**
   - SQLite: 시세 캔들, 주문/체결 로그, 전략 성과.
   - 일별 전략 성과 요약 리포트 생성 및 Slack 전송.

## 4. 시스템 아키텍처(텍스트 다이어그램)
```
[빗썸 API]
   |-- REST 시세/주문  -->  [HTTPX 클라이언트]
   |-- WebSocket 체결 -->  [WebSocket 수집기]
                                  |
                           [전략 엔진]
                                  |
           +------------------+-----------+
           |                  |           |
   [리스크 관리]       [주문 실행기]   [데이터 저장]
           |                  |           |
       [상태 모니터] <---- FastAPI ----> [Slack 알림]
```
- **핵심 기술 스택**: Python 3.11, FastAPI, HTTPX, SQLAlchemy, APScheduler, Pydantic, Poetry, SQLite.
- **인프라**: GitHub Codespaces(개발) → Railway/Render 등 컨테이너 호스팅(운영).

## 5. 개발 단계 및 일정(4주)
| 주차 | 목표 | 상세 작업 |
|------|------|-----------|
| 1주차 | 환경 & 뼈대 구축 | Codespaces 템플릿 설정, 패키지 관리(Poetry), 환경변수/시크릿 설계, FastAPI 기본 구조 생성 |
| 2주차 | 데이터 & 전략 | 빗썸 API 래퍼, WebSocket 수집, SQLite 모델링, 전략 엔진(돌파 로직) 구현 |
| 3주차 | 주문 & 리스크 | 주문 실행 파이프라인, 포지션/리스크 관리, 모의투자 모드, 슬랙 알림 |
| 4주차 | 테스트 & 배포 | 백테스트 스크립트, 통합 테스트, CI 구축, Railway/Render 배포, 운영 매뉴얼 작성 |

## 6. 우선순위 백로그
1. **필수(Must)**
   - 환경 변수/시크릿 관리 체계(.env 템플릿, Codespaces 시크릿 설정 가이드)
   - 빗썸 시세 조회 REST 클라이언트, WebSocket 수집기
   - 추세 돌파 전략(입력: 1시간봉 데이터)
   - 주문 실행 모듈 + 실패 재시도 + 체결 확인
   - 손절/익절/트레일링 스탑 로직
   - FastAPI 모니터링 엔드포인트(`/health`, `/status`, `/pause`, `/resume`)
   - SQLite 테이블(시세, 주문, 전략 로그)
   - Slack 알림 연동
2. **선호(Should)**
   - APScheduler 기반 정기 리포트(일별 성과)
   - 백테스트 스크립트 및 기본 테스트 데이터셋
   - Dockerfile + Railway/Render 배포 스크립트
3. **있으면 좋음(Could)**
   - 간단한 대시보드(UI)
   - 다중 전략 확장 구조(Strategy Registry)
   - Prometheus Metrics 노출
4. **미래 지연(Won't for MVP)**
   - 파생상품 거래 지원
   - 머신러닝 기반 시그널
   - 고빈도 트레이딩 최적화

## 7. 데이터 및 인프라 설계
- **데이터 주기**: 1시간봉(백테스트 및 실시간), 1분봉(진입 조건 미세 조정용 선택)
- **테이블 설계 요약**
  - `candles`: timestamp, open, high, low, close, volume
  - `signals`: strategy_name, timestamp, action, confidence, stop_loss, take_profit
  - `orders`: order_id, symbol, side, price, volume, status, executed_price, fee
  - `positions`: symbol, avg_price, size, unrealized_pnl, status
  - `daily_performance`: date, profit, mdd, win_rate, notes
- **보안**: Codespaces 시크릿 저장, 운영 환경은 환경 변수 + Secret Manager 사용.

## 8. 품질 & 위험 관리
- **테스트 전략**
  - 단위 테스트: 전략 로직, 주문 생성 로직
  - 통합 테스트: 빗썸 API Mocking(HTTPX Mock) + 전략 엔드투엔드
  - 회귀 테스트: 백테스트 스냅샷 비교
- **리스크**
  - API 변경 → 주기적 문서 검토, 버전 핀 고정
  - 네트워크 장애 → 재접속, 실패 시 Slack 알림
  - 전략 손실 → 일일 손실 한도, 전략 일시 중단 API

## 9. 커뮤니케이션 & 문서화
- Codespaces 공유 노트북 또는 GitHub Projects로 작업 현황 관리.
- 주요 설정/시크릿 변경 시 `docs/CLOUD_WORKFLOW_GUIDE.md` 업데이트.
- 배포 및 운영 과정은 `docs/DEPLOYMENT_RUNBOOK.md`에 기록하여 재현성 확보.

## 10. 최근 진행 현황
- Poetry 기반 패키지 초기화와 `.gitignore` 정비를 완료했습니다.
- `AppSettings`로 환경 변수에서 빗썸 API 키/Secret, 기본 URL을 관리할 수 있습니다.
- HTTPX 기반 `BithumbClient`를 추가해 시세 조회와 서명 생성 로직을 재사용할 수 있게 했습니다.
- `pytest` + `respx` 조합으로 REST 응답 파싱과 인증 헤더 생성을 검증하는 단위 테스트를 마련했습니다.

---
본 계획은 MVP 완성을 목표로 하며, 실거래 전 반드시 모의투자 및 소액 검증 단계를 거친 뒤 거래 규모를 확대하는 것을 권장합니다.
